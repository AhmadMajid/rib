<div class="post two-thirds column alpha" id="p<%= post.id %>">
    <div class="post-info">
        <span class="post-individual-id">
            <%= link_to "#{post.discussion.id if !post.discussion.nil?}", "#{url_for post.discussion}" %>
            <%= link_to "#", "#{url_for post.discussion}#p#{post.id}" %>
            <%= link_to "#{post.id}", "#{url_for post}" %>
        </span>

        <span class="post-timestamp">
            <span class="post-timestamp-created-at"><%= post.created_at %></span>
            <span class="post-timestamp-relative"><%= (Time.at(post.created_at) - Time.now).to_i / 60 %> min</span>
        </span>

        <span class="post-flag">
            <%= link_to 'Flag', "/posts/flag/#{post.id}" , :method => :put %>
        </span>
    </div>

    <% if post.title? %>
        <h5 class="post-title">
            <%= post.title %>
        </h5>
    <% end %>

    <% if post.content? %>
        <div class="post-content unexpanded">
            <%= image_tag post.content.url %>
        </div>
    <% end %>

    <% if post.text? %>
        <div class="post-text">
            <!-- Very inefficient? Tried doing in model but link_to doesn't work in models. Controller had issues finding paths -->
            <% post.text.scan(/>>(\d+)/).each do |post_id| %>
                <% if !(p = Post.find_by_id(post_id)).nil? %>
                    <% post.text.gsub!(/>>#{post_id[0]}/,
                        link_to(
                            ">>#{post_id[0]}#{" (Crosslink)" if p.discussion_id != post.discussion_id}",
                            "#{url_for p.discussion}#p#{p.id}")
                        )
                    %>
                <% end %>
            <% end %>

            <%= post.text.html_safe %>
        </div>
    <% end %>

    <% if session[:user_id] %>
        <div class="admin-controls">
            <%= link_to 'E', edit_post_path(post) %>
            <%= link_to 'D', post, method: :delete, data: { confirm: 'Are you sure?' } %>
        </div>
    <% end %>
</div>